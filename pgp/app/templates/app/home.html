{% extends 'base.html' %}

{% block title %}pGP beta1{% endblock %}

{% block content %}
<div class="bg-white shadow-md rounded p-6 mb-6">
    <h1 class="text-2xl font-bold mb-4">Velkommen, {{ user.username }}!</h1>
    <p>ðŸ¤žLa oss krysse fingrane for at dette systemet funkar!</p>
</div>

<div class="shadow-md rounded p-6 bg-white mb-6">
    <h2 class="text-xl font-bold mb-4">Aktiv pGP-runde:</h2>
    {% if active_rounds %}
        <div class="space-y-2">
            {% for round in active_rounds %}
                <div class="p-2 border-b border-gray-300 last:border-b-0">
                    <a href="{% url 'round_detail' round.id %}" class="text-blue-600 hover:underline">{{ round.name }}</a> arrangert av 
                    <span class="font-semibold text-blue-700">ðŸ‘‘{{ round.organizer.username }}</span> {# Styled organizer name #}
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-gray-700">Ingen aktive pGP-runder.</p>
    {% endif %}
</div>

{% load custom_filters %}

<!-- All-Time Player Stats Table -->
<div class="shadow-md rounded p-4 bg-white mt-6">
    <h2 class="text-xl font-bold mb-4">Totatabellen</h2>
    {% if stats %}
        <div class="overflow-x-auto">
            <table class="min-w-full table-auto border-collapse">
                <thead>
                    <tr>
                        <th class="border px-2 py-1 sm:px-4 sm:py-2 sortable" onclick="sortTable(0)">Spelar <span id="arrow0" class="sort-arrow"></span></th>
                        <th class="border px-2 py-1 sm:px-4 sm:py-2 sortable" onclick="sortTable(1)">Totale poeng <span id="arrow1" class="sort-arrow"></span></th>
                        <th class="border px-2 py-1 sm:px-4 sm:py-2 sortable" onclick="sortTable(2)">Totale poeng PGP-format <span id="arrow2" class="sort-arrow"></span></th>
                        <th class="border px-2 py-1 sm:px-4 sm:py-2 sortable" onclick="sortTable(3)">Gj. snittleg poengsum <span id="arrow3" class="sort-arrow"></span></th>
                        <th class="border px-2 py-1 sm:px-4 sm:py-2 sortable" onclick="sortTable(4)">Rundar spelt <span id="arrow4" class="sort-arrow"></span></th>
                        <th class="border px-2 py-1 sm:px-4 sm:py-2 sortable" onclick="sortTable(5)">Seirar <span id="arrow5" class="sort-arrow"></span></th>
                        <th class="border px-2 py-1 sm:px-4 sm:py-2 sortable" onclick="sortTable(6)">Sisteplassar <span id="arrow6" class="sort-arrow"></span></th>
                    </tr>
                </thead>
                <tbody>
                    {% for player_stat in stats %}
                        <tr>
                            <td class="border px-2 py-1 sm:px-4 sm:py-2">{{ player_stat.player.nickname }}</td>
                            <td class="border px-2 py-1 sm:px-4 sm:py-2">{{ player_stat.total_points }}</td>
                            <td class="border px-2 py-1 sm:px-4 sm:py-2">{{ player_stat.total_points_pgp }}</td>
                            <td class="border px-2 py-1 sm:px-4 sm:py-2">{{ player_stat.average_score }}</td>
                            <td class="border px-2 py-1 sm:px-4 sm:py-2">{{ player_stat.rounds_played }}</td>
                            <td class="border px-2 py-1 sm:px-4 sm:py-2">{{ player_stat.wins }}</td>
                            <td class="border px-2 py-1 sm:px-4 sm:py-2">{{ player_stat.bottoms }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p class="text-gray-700">Ingen stats funnet.</p>
    {% endif %}
</div>

<script>
    let currentSortOrder = true; // true for ascending, false for descending

    function sortTable(n) {
        const table = document.querySelector("table");
        const tbody = table.querySelector("tbody");
        const rows = Array.from(tbody.querySelectorAll("tr"));
    
        const isNumeric = n !== 0;
    
        rows.sort((a, b) => {
            let aText = a.children[n].innerText.trim();
            let bText = b.children[n].innerText.trim();
    
            if (isNumeric) {
                aText = parseFloat(aText) || 0;
                bText = parseFloat(bText) || 0;
            }
    
            if (aText < bText) return currentSortOrder ? -1 : 1;
            if (aText > bText) return currentSortOrder ? 1 : -1;
            return 0;
        });
    
        // Update sort order indicator
        document.querySelectorAll('.sort-arrow').forEach((arrow, index) => {
            arrow.textContent = ''; // Clear all arrows
            arrow.style.display = 'none';
        });
        const arrow = document.querySelector(`#arrow${n}`);
        arrow.textContent = currentSortOrder ? 'â–²' : 'â–¼';
        arrow.style.display = 'inline';
    
        currentSortOrder = !currentSortOrder;
    
        rows.forEach(row => tbody.appendChild(row));
    }
    
    
</script>

{% endblock %}
